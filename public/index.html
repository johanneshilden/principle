<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
    </head>
    <body data-host="http://localhost:3000" data-key="14ad0ef86bc392b39bad6009113c2a5a8a1d993a">

        <ul style="float:right">
            <li><hr>Driver app<hr></li>
            <li><hr>Depot management dashboard<hr></li>

            <li><a href="#!d/queued">Queued</a></li>
            <li><a href="#!d/dispatched">Dispatched</a></li>
            <li><a href="#!d/vehicles">Show vehicles</a></li>
            <li><a href="#!d/sidebar/drivers">Drivers</a></li>
            <li><a href="#!d/sidebar/stock-summary">Stock summary</a></li>
            <li><a href="#!d/sidebar/add-stock">Add stock</a></li>
            <li><a href="#!d/sidebar/report-damages">Report damages</a></li>
            <li><a href="#!d/sidebar/stock-adjustment">Stock adjustment</a></li>

            <li><hr>Call center dashboard<hr></li>
            <!--
            <li><hr>Order queueing dashboard<hr></li>
            <li><a href="#!q/vehicles">Available vehicles</a></li>
            <li><a href="#!c/customers/all">All customers</a></li>
            <li><a href="#!c/customers">Area customers</a></li>
            <li><a href="#!c/orders">Orders</a></li>
            <li><hr>Field staff app<hr></li>
            <li><a href="#!f/customers/all">All customers</a></li>
            <li><a href="#!f/customers">Area customers</a></li>
            <li><a href="#!f/orders">List orders</a></li>
            -->
        </ul>
        <ul style="float:right">
            <li><hr>Admin<hr></li>
            <li><a href="#queue">Queue</a></li>
            <li><a href="#flush">Clear cache</a></li>
            <li><h4 style="margin:0">User</h4></li>
            <li><a href="#users">Users</a></li>
            <li><a href="#profile">User profile</a></li>
            <li><a href="#logout">Log out</a></li>
            <li><h4 style="margin:0">Operations</h4></li>
            <li><a href="#depots">Depots</a></li>
            <li><a href="#areas">Areas</a></li>
            <li><a href="#regions">Regions</a></li>
            <li><h4 style="margin:0">Vehicle Management</h4></li>
            <li><a href="#vehicles">Vehicles</a></li>
            <!--
            <li><a href="#vehicle-maintenance">Vehicle Maintenance</a></li>
            <li><a href="#fuel">Fuel Management</a></li>
            -->
            <li><a href="#weight-classes">Vehicle Weight Classes</a></li>
            <li><a href="#maintenance-types">Maintenance Activity Types</a></li>
            <li><a href="#drivers">Drivers</a></li>
            <li><h4 style="margin:0">Customer Management</h4></li>
            <li><a href="#customers">Customers</a></li>
            <li><a href="#complaints">Complaints</a></li>
            <li><h4 style="margin:0">Stock</h4></li>
            <li><a href="#stock">Stock</a></li>
            <li><a href="#damage-types">Stock damage types</a></li>
            <li><h4 style="margin:0">Product Management</h4></li>
            <li><a href="#products">Products</a></li>
            <li><a href="#price-categories">Price Categories</a></li>
            <li><h4 style="margin:0">Order Management</h4></li>
            <li><a href="#orders">Orders</a></li>
        </ul>


        <!--
        <ul style="float:right">
            <li><hr>Driver<hr></li>
            <li><hr>Depot management<hr></li>
            <li><a href="#!d/queued">Queued orders</a></li>
            <li><a href="#!d/dispatched">Dispatched orders</a></li>
            <li><a href="#!d/sidebar/drivers">Drivers</a></li>
            <li><a href="#!d/sidebar/stock-summary">Stock summary</a></li>
            <li><a href="#!d/sidebar/add-stock">Add stock</a></li>
            <li><a href="#!d/sidebar/report-damages">Report damages</a></li>
            <li><a href="#!d/sidebar/stock-adjustment">Stock adjustment</a></li>
            <li><hr>Order queueing<hr></li>
            <li><a href="#!q/vehicles">Available vehicles</a></li>
            <li><a href="#!q/vehicle/1">Show vehicle</a></li>
            <li><a href="#!q/dispatches">Dispatches</a></li>
            <li><a href="#!q/dispatch/1">Show dispatch</a></li>
            <li><a href="#!q/order/1">Show order</a></li>
            <li><a href="#!q/product/1">Show product</a></li>
            <li><a href="#!q/load/vehicle/1">Load on vehicle</a></li>
            <li><hr>Callcenter<hr></li>
            <li><a href="#!c/customers">Customers</a></li>
            <li><a href="#!c/location/customer/1">View customer location</a></li>
            <li><a href="#!c/tasks/customer/1">View tasks for customer</a></li>
            <li><a href="#!c/orders/customer/1">View orders for customer</a></li>
            <li><a href="#!c/complaints/customer/1">View complaints for customer</a></li>
            <li><a href="#!c/activity/customer/1">View activity for customer</a></li>
            <li><a href="#!c/contacts/customer/1">View contacts for customer</a></li>
            <li><a href="#!c/customer/1">View customer</a></li>
            <li><a href="#!c/activity">Register activity</a></li>
            <li><a href="#!c/orders/date/1">show orders for date</a></li>
            <li><a href="#!c/orders">show orders</a></li>
            <li><a href="#!c/order/edit/1">edit order</a></li>
            <li><a href="#!c/order/delete/1">delete order</a></li>
            <li><a href="#!c/order/1">view order</a></li>
            <li><a href="#!c/price-list">price list</a></li>
            <li><a href="#!c/product/1">show product</a></li>
            <li><a href="#!c/sidebar/tasks">show tasks</a></li>
            <li><a href="#!c/sidebar/stock">show stock</a></li>
            <li><a href="#!c/sidebar/calendar">show calendar</a></li>
            <li><hr>Fieldstaff<hr></li>
            <li><a href="#!f/customers">Customers</a></li>
            <li><a href="#!f/customers/all">All customers</a></li>
            <li><a href="#!f/orders">Orders</a></li>
            <li><a href="#!f/stock">Show stock</a></li>
        </ul>
        <ul style="float:right">
            <li><hr>Admin<hr></li>
            <li><a href="#queue">Queue</a></li>
            <li><a href="#flush">Clear cache</a></li>
            <li><a href="#logout">Log out</a></li>
            <li><a href="#areas">Areas</a></li>
            <li><a href="#complaints">Complaints</a></li>
            <li><a href="#customers">Customers</a></li>
            <li><a href="#customer/create">Create customer</a></li>
            <li><a href="#damage-types">Damage types</a></li>
            <li><a href="#stock">Stock management</a></li>
            <li><a href="#stock-activity/depot/1">Stock activity for depot</a></li>
            <li><a href="#depots">Depots</a></li>
            <li><a href="#driver">Driver management</a></li>
            <li><a href="#fuel-management">Fuel management</a></li>
            <li><a href="#vehicle-maintenance">Maintenance</a></li>
            <li><a href="#maintenance-types">Maintenance types</a></li>
            <li><a href="#price-categories">Price categories</a></li>
            <li><a href="#products">Products</a></li>
            <li><a href="#regions">Regions</a></li>
            <li><a href="#vehicles">All vehicles</a></li>
            <li><a href="#vehicle/create">Create vehicle</a></li>
            <li><a href="#weight-classes">Weight classes</a></li>
            <li><a href="#users">Users</a></li>
            <li><a href="#user/create">Create user</a></li>
            <li><a href="#commissions/edit">Commission matrix</a></li>
            <li><a href="#system/activity">System activity</a></li>

            <li>Manage field staff</li>
            <li>Manage call center staff</li>
       </ul>
        -->

        <div id="info"></div>
        <div id="main"></div>
        <hr>
        <table class="notifications" id="log"></table>

        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/handlebars-template.js"></script>
        <script type="text/javascript" src="js/jquery.validate.min.js"></script>
        <script type="text/javascript" src="js/rollups/aes.js"></script>
        <script type="text/javascript" src="js/underscore-min.js"></script>
        <script type="text/javascript" src="js/backbone-min.js"></script>
        <script type="text/javascript" src="js/handlebars-v1.3.0.js"></script>
        <script type="text/javascript" src="js/store.min.js"></script>
        <script type="text/javascript" src="js/hmac-sha1.js"></script>
        <script type="text/javascript" src="js/sockjs-0.3.min.js"></script>
        <script type="text/javascript" src="js/stomp.js"></script>
        <script type="text/javascript" src="js/ba-routematcher.min.js"></script>
        <script type="text/javascript" src="js/storage2.js"></script>
        <script type="text/javascript" src="js/model.js"></script>
        <script type="text/javascript" src="js/admin3.js"></script>
 
        <script type="text/javascript">
            App.listen({
                user  : 'guest',
                pass  : 'guest',
                url   : 'http://127.0.0.1:55674/stomp',
                map   : {
                    "user/:id": function(obj, method) {
                        Storage.purge(['users', 'depots']);
                    },
                    "user": function(obj, method) {
                        Storage.purge(['users', 'depots']);
                    },
                    "region/:id": function(obj, method) {
                        Storage.purge('regions');
                    },
                    "region": function(obj, method) {
                        Storage.purge('regions');
                    },
                    "!depot/:id": function(obj, method) {
                        Storage.purge(['depots', 'areas', 'users']);
                    },
                    "!depot": function(obj, method) {
                        Storage.purge(['depots', 'areas', 'users']);
                    },
                    "!area/:id": function(obj, method) {
                        Storage.purge(['areas', 'users', 'area-users']);
                    },
                    "area": function(obj, method) {
                        Storage.purge(['areas', 'users', 'area-users']);
                    },
                    "vehicle/:id": function(obj, method) {
                        Storage.purge('vehicles');
                    },
                    "!vehicle/:id": function(obj, method) {
                        Storage.purge('vehicles');
                    },
                    "vehicle": function(obj, method) {
                        Storage.purge('vehicles');
                    },
                    "customer/:id": function(obj, method) {
                        Storage.purge('customers');
                    },
                    "customer": function(obj, method) {
                        Storage.purge('customers');
                    },
                    "contact/customer/:id": function(obj, method) {
                        Storage.purge('customers');
                        Storage.purge('contacts-customer-' + obj.id);
                    },
                    "contact/:id/customer/:customerId": function(obj, method) {
                        Storage.purge('customers');
                        Storage.purge('contacts-customer-' + obj.customerId);
                    },
                    "maintenance-activity-type/:id": function(obj, method) {
                        Storage.purge('maintenance-types');
                    },
                    "maintenance-activity-type": function(obj, method) {
                        Storage.purge('maintenance-types');
                    },
                     "complaint/resolve/:id": function(obj, method) {
                        Storage.purge('complaints');
                    },
                    "stock-damage-type/:id": function(obj, method) {
                        Storage.purge('stock-damage-types');
                    },
                    "stock-damage-type": function(obj, method) {
                        Storage.purge('stock-damage-types');
                    },
                    "!stock/add/depot/:id": function(obj, method) {
                        Storage.purge(['stock-' + obj.id, 'stock-activity']);
                    },
                    "!stock/remove/depot/:id": function(obj, method) {
                        Storage.purge(['stock-' + obj.id, 'stock-activity']);
                    },
                    "!stock/report-damage/depot/:id": function(obj, method) {
                        Storage.purge(['stock-' + obj.id, 'stock-activity']);
                    },
                    "price-category/:id": function(obj, method) {
                        Storage.purge(['price-categories', 'products']);
                    },
                    "price-category": function(obj, method) {
                        Storage.purge(['price-categories', 'products']);
                    },
                    "!price-category/:id": function(obj, method) {
                        Storage.purge(['price-categories', 'products']);
                    },
                    "!product/:id": function(obj, method) {
                        Storage.purge('products');
                    },
                    "!product": function(obj, method) {
                        Storage.purge('products');
                    },
                    "weight-category/:id": function(obj, method) {
                        Storage.purge(['weight-categories', 'products']);
                    },
                    "!weight-category/:id": function(obj, method) {
                        Storage.purge(['weight-categories', 'products']);
                    },
                    "weight-category": function(obj, method) {
                        Storage.purge(['weight-categories', 'products']);
                    }
                }
            });

            Storage.setPassiveMode(true);

            Handlebars.registerHelper('if_eq', function(a, b, opts) {
                if (a == b) return opts.fn(this);
                else return opts.inverse(this);
            });

            Handlebars.registerHelper('if_ne', function(a, b, opts) {
                if (a != b) return opts.fn(this);
                else return opts.inverse(this);
            });

            Handlebars.registerHelper('when', function(a, opts) {
                if (a && !_.isEmpty(a)) return opts.fn(this);
                else return opts.inverse(this);
            });

            $('.notifications').delegate('.note-dismiss', 'click', function() {
                $(this).parent().parent().remove();
            });

            $(document).ready(function() {

                $.validator.addMethod("datetime", function (value, element) {
                    return this.optional(element) || /(\d{4})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2}).(\d)/.test(value);
                }, "Please enter a date-time in the format YYYY-MM-DD hh:mm:ss.s");

                $.validator.addMethod("moreRecentThan", function (value, element, d) {
                    var date1 = new Date(value),
                        date2 = new Date(d);
                    return this.optional(element) || date1 > date2;
                }, "Please specify a date and time more recent than {0}");

            });

            T.prefetch('admin/error');
            T.prefetch('admin/login');
            T.prefetch('admin/queue');
            T.prefetch('admin/offline');

            T.prefetch('admin/area/create');
            T.prefetch('admin/area/delete');
            T.prefetch('admin/area/edit');
            T.prefetch('admin/area/index');
            T.prefetch('admin/area/view');

            T.prefetch('admin/complaint/customer');
            T.prefetch('admin/complaint/index');
            T.prefetch('admin/complaint/view');

            T.prefetch('admin/contact/create');
            T.prefetch('admin/contact/delete');
            T.prefetch('admin/contact/edit');

            T.prefetch('admin/customer/create');
            T.prefetch('admin/customer/edit');
            T.prefetch('admin/customer/index');
            T.prefetch('admin/customer/view');
            T.prefetch('admin/customer/activity');
            T.prefetch('admin/customer/contacts');

            T.prefetch('admin/depot/create');
            T.prefetch('admin/depot/delete');
            T.prefetch('admin/depot/edit');
            T.prefetch('admin/depot/index');
            T.prefetch('admin/depot/view');

            T.prefetch('admin/maintenance-activity-type/create');
            T.prefetch('admin/maintenance-activity-type/delete');
            T.prefetch('admin/maintenance-activity-type/edit');
            T.prefetch('admin/maintenance-activity-type/index');

            T.prefetch('admin/price-category/create');
            T.prefetch('admin/price-category/delete');
            T.prefetch('admin/price-category/edit');
            T.prefetch('admin/price-category/index');

            T.prefetch('admin/product/create');
            T.prefetch('admin/product/recover');
            T.prefetch('admin/product/edit');
            T.prefetch('admin/product/index');
            T.prefetch('admin/product/view');

            T.prefetch('admin/region/create');
            T.prefetch('admin/region/delete');
            T.prefetch('admin/region/edit');
            T.prefetch('admin/region/index');
            T.prefetch('admin/region/view');

            T.prefetch('admin/stock-damage-type/create');
            T.prefetch('admin/stock-damage-type/delete');
            T.prefetch('admin/stock-damage-type/edit');
            T.prefetch('admin/stock-damage-type/index');

            T.prefetch('admin/stock/depot-select');
            T.prefetch('admin/stock/summary');
            T.prefetch('admin/stock/activity');

            T.prefetch('admin/user/create');
            T.prefetch('admin/user/delete');
            T.prefetch('admin/user/edit');
            T.prefetch('admin/user/index');
            T.prefetch('admin/user/view');
            T.prefetch('admin/user/password');
            T.prefetch('admin/user/select');

            T.prefetch('admin/vehicle/create');
            T.prefetch('admin/vehicle/delete');
            T.prefetch('admin/vehicle/edit');
            T.prefetch('admin/vehicle/index');
            T.prefetch('admin/vehicle/view');

            T.prefetch('admin/driver/index');

            T.prefetch('admin/weight-category/create');
            T.prefetch('admin/weight-category/delete');
            T.prefetch('admin/weight-category/edit');
            T.prefetch('admin/weight-category/index');

            T.prefetch('admin/fuel/vehicle');
            T.prefetch('admin/fuel/add');
            T.prefetch('admin/fuel/vehicle-index');

            T.prefetch('admin/maintenance/vehicle');
            T.prefetch('admin/maintenance/vehicle-index');
            T.prefetch('admin/maintenance/register');
            T.prefetch('admin/maintenance/complete');

            T.prefetch('admin/order/index');
            T.prefetch('admin/order/view');
            T.prefetch('admin/order/edit');

        </script>

    </body>
</html>
